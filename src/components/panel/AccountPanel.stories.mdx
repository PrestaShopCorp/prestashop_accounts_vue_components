import { Meta, Story, Description, ArgsTable } from '@storybook/addon-docs';
import { action } from '@storybook/addon-actions';

import AccountPanel from './AccountPanel.vue';

<Meta
  title="Components/Panels/AccountPanel"
  component={AccountPanel} />

export const Template = (args, { argTypes }) => ({
  props: Object.keys(argTypes),
  components: { AccountPanel },
  template: `<AccountPanel v-bind="$props" class="m-4" />`,
})

# Association panel behavior

The `AccountPanel` component is here to let the user associate his shop to PrestaShop services (PS Accounts).
This component is only in charge of displaying the final panel to let the account association be done.

_Notice: If context conditions or pre-requisites are not filled, alert messages should be shown (please
see in the Alerts components section, or use the main component `PsAccounts` that does these checks for
you in the integration section)._

## Before association, a button is displayed:

<Story
  name='Not associated'
  height='175px'
  args={{
    accountsUiUrl: 'https://accounts.distribution.prestashop.net/en',
    isOnboardedV4: false,
    onboardingLink: 'https://accounts.prestashop.com?shops=',
    shops: [{
      domain: 'myshop.com',
      employeeId: null,
      isLinkedV4: false,
      user: {
        email: null,
      },
      uuid: null,
    }],
    shopContext: 4,
    ssoResendVerificationEmail: 'http://sso.prestashop.com/email',
    superAdminEmail: 'admin@example.com',
    user: {
      emailIsValidated: true,
      employeeId: 1,
      isSuperAdmin: true,
    },
    backendUser: {
      email: 'admin@example.com',
      isSuperAdmin: true,
      employeeId: 1,
    },
  }}>
  {Template.bind({})}
</Story>

The button will bring the user to PrestaShop Accounts modal to link the shop to a user account (the owner / merchant)
then go back to the module page that displayed the component.

The association is made once (for all PrestaShop services) so maybe it won't be displayed as this
if the shop was already linked to PrestaShop services from another service module before.


## After association, the linked user is shown:

<Story
  name='Associated'
  height='175px'
  args={{
    accountsUiUrl: 'https://accounts.distribution.prestashop.net/en',
    isOnboardedV4: false,
    onboardingLink: 'https://accounts.prestashop.com?shops=',
    shops: [{
      domain: 'myshop.com',
      employeeId: 1,
      isLinkedV4: false,
      user: {
        email: 'user@example.com',
        emailIsValidated: true
      },
      uuid: 'abcde-fghij',
    }],
    shopContext: 4,
    ssoResendVerificationEmail: 'http://sso.prestashop.com/email',
    superAdminEmail: 'admin@example.com',
    user: {
      email: 'admin@example.com',
      isSuperAdmin: true,
      employeeId: 1,
    },
    backendUser: {
      email: 'admin@example.com',
      isSuperAdmin: true,
      employeeId: 1,
    },
  }}>
  {Template.bind({})}
</Story>


---
# Specific behaviors

## If the user is not admin:

The shop's owner / merchant **must** have administrator rights to be able to link its shop to PrestaShop services.
If the right is missing, the button will be disabled and **a warning will be shown** to the user:

<Story
  name='Need to be admin'
  height='175px'
  args={{
    accountsUiUrl: 'https://accounts.distribution.prestashop.net/en',
    isOnboardedV4: false,
    onboardingLink: 'https://accounts.prestashop.com?shops=',
    shops: [{
      domain: 'myshop.com',
      employeeId: null,
      isLinkedV4: false,
      user: {
        email: null,
      },
      uuid: null,
    }],
    shopContext: 4,
    ssoResendVerificationEmail: 'http://sso.prestashop.com/email',
    superAdminEmail: 'admin@example.com',
    user: {
      email: 'admin@example.com',
      isSuperAdmin: true,
      employeeId: 1,
    },
    backendUser: {
      email: 'admin@example.com',
      isSuperAdmin: false,
      employeeId: 1,
    },
  }}>
  {Template.bind({})}
</Story>


## If the user has not confirmed (yet) its email:

During the linking process, the user can create a new/unconfirmed PrestaShop account to link its shop.
In this case, after this process, **a warning will remain that the user must confirm his email** (clicking on a
link received in his email box):

<Story
  name='Email validation needed'
  height='175px'
  args={{
    accountsUiUrl: 'https://accounts.distribution.prestashop.net/en',
    isOnboardedV4: false,
    onboardingLink: 'https://accounts.prestashop.com?shops=',
    shops: [{
      domain: 'myshop.com',
      employeeId: 1,
      isLinkedV4: false,
      user: {
        email: 'user@example.com',
      },
      uuid: 'abcde-fghij',
    }],
    shopContext: 4,
    ssoResendVerificationEmail: 'http://sso.prestashop.com/email',
    superAdminEmail: 'admin@example.com',
    user: {
      emailIsValidated: false,
      employeeId: 1,
      isSuperAdmin: true,
    },
    backendUser: {
      email: 'admin@example.com',
      isSuperAdmin: true,
      employeeId: 1,
    },
  }}>
  {Template.bind({})}
</Story>


## A slot inside the card

If you need to integrate a slot inside the card, below the merchant account section:

export const SlotTemplate = (args, { argTypes }) => ({
  props: Object.keys(argTypes),
  components: { AccountPanel },
  template: `
    <AccountPanel v-bind="$props" class="m-4">
      <div style="padding: 0.5rem; background: gray; color: #fff;">Put here a slot</div>
    </AccountPanel>`,
})

<Story
  name='Case with a slot'
  height='175px'
  args={{
    accountsUiUrl: 'https://accounts.distribution.prestashop.net/en',
    isOnboardedV4: false,
    onboardingLink: 'https://accounts.prestashop.com?shops=',
    shops: [{
      domain: 'myshop.com',
      employeeId: 1,
      isLinkedV4: false,
      user: {
        email: 'user@example.com',
        emailIsValidated: true,
      },
      uuid: 'abcde-fghij',
    }],
    shopContext: 4,
    ssoResendVerificationEmail: 'http://sso.prestashop.com/email',
    superAdminEmail: 'admin@example.com',
    user: {
      emailIsValidated: true,
      employeeId: 1,
      isSuperAdmin: true,
    },
    backendUser: {
      email: 'admin@example.com',
      isSuperAdmin: true,
      employeeId: 1,
    },
  }}>
  {SlotTemplate.bind({})}
</Story>

You still need to manage the spacing of your slot with CSS.


---
# Integration

_Notice: If you need to integrate the standard behavior of PS Accounts, please see the
[`PsAccounts` component in the integration section](?path=/docs/integration-psaccounts-panel--connected)._

If you need a custom integration of PS Accounts sub-components, here is the AccountPanel panel:

```html
<AccountPanel
  :accounts-ui-url="validContext.accountsUiUrl"
  :backend-user="validContext.backendUser"
  :onboarding-link="validContext.onboardingLink"
  :shops="shops"
  :shop-context="validContext.currentContext.type"
  :sso-resend-verification-email="validContext.ssoResendVerificationEmail"
  :super-admin-email="validContext.superAdminEmail"
>
  <slot
    v-if="hasAllShopsLinked"
    name="account-footer"
  />
</AccountPanel>
```

# Technical details

<Description of={AccountPanel} />
<ArgsTable of={AccountPanel} />
